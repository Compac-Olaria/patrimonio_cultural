<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Caça ao Patrimônio Cultural</title>
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="  https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css  ">
  <style>
    :root{
      /* Paleta */
      --marrom-escuro:#5D4037; --marrom:#795548; --marrom-claro:#8D6E63;
      --bege:#F5F5DC; --bege-claro:#EFEBE9; --vinho:#722F37; --verde-musgo:#556B2F;
      --texto:#3E2723; --borda:#A1887F; --areia:#E9D9B5; --areia-dark:#D6C197; --terra:#6d4c41; --terra2:#8a5f4a;
      --pedra:#718095; --pedra-escura:#5b677a; --pedra-borda:#a5b1c2;
      /* Cores para números e caveiras */
      --c1:#7ec8ff; /* Azul Claro (número) */
      --c2:#9ACD32; /* Verde (número) */
      --c3:#FFD54F; /* Amarelo (número) */
      --c4:#FF9800; /* Laranja (número) */
      --c5:#E53935; /* Vermelho (número) */
      --c6:#DC143C; /* Carmesim (número) */
      --c7:#722F37; /* Vinho (número) */
      --c8:#8B4513; /* Marrom (número) */
      /* Cores para caveiras */
      --skull1:#FFD700; /* Amarelo Dourado */
      --skull2:#FF9800; /* Laranja */
      --skull3:#F44336; /* Vermelho */
      --skull4:#DC143C; /* Carmesim */
      --skull5:#722F37; /* Vinho */
      --skull6:#8B4513; /* Marrom Avermelhado */
      --skull7:#5D4037; /* Marrom escuro */
      --skull8:#000000; /* Preto */
      /* tamanho célula (ajustado via JS) */
      --cell:56px;
      
      /* Novas variáveis para o estilo atualizado */
      --primary-color: #5D4037;
      --secondary-color: #8D6E63;
      --accent-color: #795548;
      --highlight-color: #722F37;
      --success-color: #556B2F;
      --bg-color: #F5F5DC;
      --card-bg: #EFEBE9;
      --text-color: #3E2723;
      --border-color: #A1887F;
      --stone-color: #5D4037;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(135deg,#d7ccc8,#bcaaa4);color:var(--texto);font-family:'Lato',sans-serif;overflow:hidden}
    .hidden{display:none!important}
    /* Bloqueio retrato */
    #orientationLock{display:none!important;}
    /* Telas (início/fim) - Estilo atualizado */
    .screen{position:fixed;inset:0;display:flex;background:rgba(0,0,0,.8);z-index:1000;padding:16px; flex-direction:column; justify-content:center; align-items:center; }
    .modal-content{
      width:min(600px, 92vw);
      background:var(--bg-color);
      border:2px solid var(--border-color);
      border-radius:20px;
      box-shadow:0 10px 30px rgba(0,0,0,.3);
      padding:15px;
      text-align:center;
      animation:slideIn 0.5s ease;
      min-height:auto;
      max-height:95vh;
      display:flex;
      flex-direction:column;
      justify-content:center;
      position:relative;
      gap:6px;
      overflow-y:auto;
      margin-top: 0;
    }
    @keyframes slideIn{from{transform:translateY(-50px);opacity:0} to{transform:translateY(0);opacity:1}}
    .logo-container{text-align:center;margin-bottom:0}
    .logo-img{max-height:60px}
    .game-title{
      font-family:'Merriweather',serif;
      color:var(--primary-color);
      font-size:clamp(1.3rem, 3.5vw, 2.1rem);
      font-weight:bold;
      margin:4px 0;
      text-shadow:1px 1px 3px rgba(0,0,0,.2)
    }
    .game-subtitle{
      font-family:'Lato',sans-serif;
      color:var(--accent-color);
      font-size:clamp(0.8rem, 1.6vw, 1.1rem);
      margin:4px 0 8px 0;
    }
    .difficulty-buttons{display:flex;gap:8px;justify-content:center;margin:6px 0;flex-wrap:wrap}
    .btn-difficulty{padding:6px 12px;border:2px solid var(--primary-color);background:#fff;color:var(--primary-color);border-radius:25px;transition:all .3s ease;cursor:pointer;font-family:'Lato',sans-serif;font-weight:700; font-size: 0.8rem;}
    .btn-difficulty:hover,.btn-difficulty.active{background:var(--primary-color);color:#fff}
    .btn-game{
      background:var(--highlight-color);
      color:#fff;
      border:none;
      padding:10px 25px;
      font-size:1rem;
      border-radius:30px;
      transition:all .3s ease;
      box-shadow:0 4px 15px rgba(114,47,55,.3);
      font-family:'Lato',sans-serif;
      font-weight:700;
      display:block;
      margin:12px auto;
    }
    .btn-game:hover{background:var(--primary-color);transform:translateY(-2px);box-shadow:0 6px 20px rgba(93,64,55,.4)}
    
    /* Estatísticas - Estilo atualizado */
    .game-stats{
      display:flex;
      justify-content:center;
      gap:10px;
      margin-bottom:20px;
      flex-wrap:wrap;
    }
    .stat-box{
      background:var(--primary-color);
      color:#fff;
      padding:8px 10px;
      border-radius:10px;
      text-align:center;
      min-width:80px;
      box-shadow:0 5px 15px rgba(0,0,0,.2);
      transition:transform .3s ease;
      border:1px solid var(--secondary-color)
    }
    .stat-inline{
      display:flex;
      flex-direction:column;
      align-items:center;
      padding: 8px 10px;
    }
    .stat-box:hover{transform:translateY(-5px)}
    .stat-label{font-size:.75rem;opacity:.9}
    .stat-value{font-size:1.2rem;font-weight:bold}
    .stat-inline .stat-label {
      font-size: .7rem;
      text-transform: uppercase;
      font-weight: 600;
    }
    .stat-inline .stat-value {
      font-size: 1.1rem;
    }
    /* Botão home dentro da modal - posicionado no canto superior esquerdo */
    .home-button-modal{
      background:var(--highlight-color);
      color:#fff;
      border:none;
      border-radius:50%;
      width:40px;
      height:40px;
      font-size:20px;
      cursor:pointer;
      box-shadow:0 4px 8px rgba(0,0,0,.2);
      display:flex;
      align-items:center;
      justify-content:center;
      position:absolute;
      top:10px;
      left:10px;
      z-index:1010
    }
    /* Botão de som */
    .btn-sound {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--highlight-color);
      color: white;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .btn-sound.muted {
      background: var(--marrom-escuro);
    }
    .btn-sound.muted::after,
    .btn-sound.muted::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 100%;
      height: 2px;
      background: white;
      transform: translate(-50%, -50%);
    }
    .btn-sound.muted::after {
      transform: translate(-50%, -50%) rotate(45deg);
    }
    .btn-sound.muted::before {
      transform: translate(-50%, -50%) rotate(-45deg);
    }
    /* Layout principal (mantido) */
    .app{position:fixed;inset:0;display:flex;gap:10px;padding:10px;align-items:stretch}
    .panel{position:relative;width:min(420px,34vw);min-width:240px;max-width:42vw;background:rgba(255,255,255,.9);border:2px solid var(--borda);border-radius:14px;padding:12px;box-shadow:0 8px 24px rgba(0,0,0,.25);display:flex;flex-direction:column}
    .panel h3{font-family:'Merriweather',serif;margin:6px 0 8px;color:var(--marrom-escuro);font-size:clamp(16px,2vw,22px)}
    .stats{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px}
    .stat{background:var(--marrom-escuro);color:#fff;border-radius:10px;padding:8px;text-align:center;border:1px solid var(--marrom-claro)}
    .stat .label{font-size:clamp(.7rem,1.2vw,.95rem);opacity:.92}
    .stat .val{font-size:clamp(.95rem,1.7vw,1.3rem);font-weight:800;font-family:'Lato',sans-serif;text-shadow:1px 1px 2px #000}
    .rules{background:var(--bege-claro);border:1px solid var(--borda);border-radius:10px;padding:10px;font-size:clamp(.72rem,1.1vw,.92rem);line-height:1.35;width:100%}
    /* Botões no painel lateral (estilo original) */
    .btn{border:none;border-radius:26px;padding:10px 16px;background:var(--vinho);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 6px 16px rgba(114,47,55,.35)}
    .btn-outline{background:#fff;color:var(--marrom-escuro);border:2px solid var(--marrom-escuro)}
    .btn-outline.active,.btn-outline:hover{background:var(--marrom-escuro);color:#fff}
    .row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
    .board-wrap{flex:1;display:flex;align-items:center;justify-content:center;min-width:0}
    .board{--cols:12;--rows:10;display:grid;gap:0;grid-template-columns:repeat(var(--cols), var(--cell));grid-auto-rows:var(--cell);border:2px dashed var(--borda);border-radius:14px;background:rgba(255,255,255,.6);box-shadow:inset 0 2px 8px rgba(0,0,0,.15);max-width:100%;max-height:100%}
    /* Células quadradas coladas */
    .cell{position:relative;width:var(--cell);height:var(--cell);border-radius:0;display:flex;align-items:center;justify-content:center;user-select:none;border:1px dashed rgba(255,255,255,.45);background:linear-gradient(145deg,var(--terra),var(--terra2));box-shadow:inset 0 4px 0 rgba(255,255,255,.08), inset 0 -6px 10px rgba(0,0,0,.35);overflow:hidden}
    .cell.vegetation::after{content:"";position:absolute;inset:0;background:radial-gradient(circle at 30% 35%, rgba(46,125,50,.25), transparent 45%);pointer-events:none}
    .cell.revealed{background:linear-gradient(135deg,var(--areia-dark),#cdb786);border-style:solid;border-color:#d2b98f;box-shadow:inset 0 2px 0 rgba(255,255,255,.5), inset 0 -4px 8px rgba(0,0,0,.12)}
    .cell.block{cursor:not-allowed;background:linear-gradient(135deg,var(--pedra),var(--pedra-escura));border:1px solid var(--pedra-borda);box-shadow:inset 0 2px 0 rgba(255,255,255,.2), inset 0 -6px 10px rgba(0,0,0,.45)}
    /* cursor de pá personalizado - reduzido */
    .cell.selectable{cursor: url('icon_pa.png') 4 4, pointer;}
    /* Conteúdos - RESTAURADO layout original */
    .num{font-weight:900;font-size:clamp(18px,2vw,24px);font-family:'Lato',sans-serif;text-shadow:1px 1px 2px #000}
    .tile-flex{display:flex;align-items:center;width:100%;padding:0 6px}
    .spacer{flex:1}
    .skulls{display:grid;grid-template-columns:repeat(1, var(--sk,14px));gap:1px}
    .skull-small{width:var(--sk,14px);height:var(--sk,14px);filter:drop-shadow(0 1px 1px rgba(0,0,0,.25))}
    .thumb{width:100%;height:100%;object-fit:cover}
    .skull{width:60%;height:60%}
    /* Efeito de poeira para substituir a animação da pá */
    .dust {
      position: absolute;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      filter: blur(2px);
      opacity: 0;
      pointer-events: none;
      z-index: 3;
    }
    /* Animação rápida de explosão de poeira */
    @keyframes fast-puff {
      0% {
        transform: translate(0, 0) scale(0.1);
        opacity: 0;
      }
      10% {
        opacity: 0.9;
      }
      100% {
        transform: translate(var(--x), var(--y)) scale(var(--scale));
        opacity: 0;
      }
    }
    /* Popup do bem: mesmo tamanho da lateral, sobre a lateral */
    #popup{position:fixed;background:var(--bege);border:2px solid var(--borda);border-radius:12px;padding:10px;z-index:1500;width:360px;max-width:34vw;display:flex;flex-direction:column;align-items:center;box-shadow:0 12px 30px rgba(0,0,0,.45)}
    #popup img{width:100%;height:auto;border-radius:10px;border:2px solid rgba(113,81,61,.4);margin-bottom:8px}
    #popup h4{margin:0 0 6px 0;font-family:'Merriweather',serif;color:var(--marrom-escuro)}
    #popup p{margin:0; font-size: 0.9rem; line-height: 1.4;}
    /* Aviso de saqueador */
    #warningBox{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#f28b82;color:#fff;border:2px solid #b03030;border-radius:14px;padding:12px 16px;z-index:1600;display:flex;align-items:center;gap:12px;box-shadow:0 10px 22px rgba(0,0,0,.35)}
    #warningBox svg{width:32px;height:32px}
    /* Estatísticas na tela final */
    .final-stats-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin: 10px 0;
    }
    .stat-inline {
      background: var(--primary-color);
      color: #fff;
      padding: 6px 8px;
      border-radius: 10px;
      text-align: center;
      min-width: 70px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      transition: transform 0.3s ease;
      border: 1px solid var(--secondary-color);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .stat-inline .stat-label {
      font-size: .65rem;
      opacity: .9;
      line-height: 1;
    }
    .stat-inline .stat-value {
      font-size: 1rem;
      font-weight: bold;
    }
    @media (max-width: 980px){ .panel{min-width:220px;max-width:40vw;} .stat .val{font-size:.95rem} .panel h3{font-size:1rem} }
    @media (max-height: 640px){ .panel{transform:scale(.95); transform-origin: top left;} }
    /* Para dispositivos móveis em modo paisagem */
    @media (max-width: 980px) and (orientation: landscape) {
      .screen {
        padding-top: 0;
        justify-content: center;
      }
      
      /* Aumentando o tamanho da caixa bege no modo paisagem */
      .modal-content {
        margin-top: 0;
        width: min(700px, 96vw); /* Aumentado de 92vw para 96vw */
        max-height: 98vh; /* Aumentado de 95vh para 98vh */
        padding: 20px; /* Aumentado de 15px para 20px */
      }
      
      /* Aumentando o tamanho dos elementos dentro da caixa */
      .game-title {
        font-size: clamp(1.5rem, 4vw, 2.4rem); /* Aumentado de 3.5vw para 4vw */
      }
      
      .game-subtitle {
        font-size: clamp(0.9rem, 1.8vw, 1.2rem); /* Aumentado de 1.6vw para 1.8vw */
      }
      
      .btn-difficulty {
        padding: 8px 16px; /* Aumentado de 6px 12px para 8px 16px */
        font-size: 0.9rem; /* Aumentado de 0.8rem para 0.9rem */
      }
      
      .btn-game {
        padding: 12px 30px; /* Aumentado de 10px 25px para 12px 30px */
        font-size: 1.1rem; /* Aumentado de 1rem para 1.1rem */
      }
      
      /* Adicionando o ícone da pá quando o botão é selecionado no celular */
      .cell.selectable:active::after {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 32px;
        height: 32px;
        background-image: url('icon_pa.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        z-index: 2;
        opacity: 0.8;
        pointer-events: none;
        animation: appear 0.1s ease-in;
      }
      
      @keyframes appear {
        0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
        100% { transform: translate(-50%, -50%) scale(1); opacity: 0.8; }
      }
    }
    /* ===== CÓDIGO IMPLEMENTADO PARA FORÇAR MODO PAISAGEM ===== */
    @media (orientation: portrait) {
      html {
        overflow: hidden;
      }
      body {
        width: 100vh;
        height: 100vw;
        overflow: hidden;
        transform-origin: top left;
        transform: rotate(90deg) translateY(-100vw);
      }
    }
  </style>
</head>
<body>
  <div id="orientationLock" class="hidden"><div><h2 style="font-family:'Merriweather',serif">Gire o dispositivo</h2><p>Este jogo funciona melhor na posição paisagem. Por favor, gire seu aparelho para continuar.</p></div></div>
  <section id="start" class="screen">
    <div class="modal-content">
      <button class="home-button-modal" onclick="window.location.href='atividade.html'">
        <i class="bi bi-house-door"></i>
      </button>
      <div class="logo-container">
        <img src="Logo.png" alt="Logo" class="logo-img">
      </div>
      <h1 class="game-title">Caça ao Patrimônio Cultural</h1>
      <p class="game-subtitle">
        Descubra os tesouros do <strong>Patrimônio Cultural</strong> do município de <strong>Olaria/MG</strong> e aprenda sobre nossa história.
      </p>
      <div class="difficulty-buttons" id="levels">
        <button class="btn-difficulty active" data-level="beginner">Iniciante</button>
        <button class="btn-difficulty" data-level="easy">Fácil</button>
        <button class="btn-difficulty" data-level="medium">Médio</button>
        <button class="btn-difficulty" data-level="hard">Difícil</button>
      </div>
      <button class="btn-game" id="btnStart">
        <i class="bi bi-play-fill"></i> Iniciar Jogo
      </button>
    </div>
  </section>
  <main class="app hidden" id="app" aria-hidden="true">
    <aside class="panel" id="leftPanel">
      <h3>Encontre todos os bens culturais</h3>
      <div class="stats">
        <div class="stat"><div class="label">Bens Culturais</div><div class="val" id="goodsStat">0 de 0</div></div>
        <div class="stat"><div class="label">Saqueadores</div><div class="val" id="raidersStat">0 de 0</div></div>
        <div class="stat"><div class="label">Tempo</div><div class="val" id="timer">0s</div></div>
        <div class="stat"><div class="label">Escavações</div><div class="val" id="excavations">0 de 0</div></div>
      </div>
      <div class="rules">
        <p>• <strong>Cuidado com os saqueadores:</strong> se encontrar 3, o jogo termina.</p>
        <p>• A quantidade de caveiras indica quantos saqueadores há ao redor (inclui diagonais).</p>
        <p>• Os números indicam quantos bens culturais há ao redor (inclui diagonais).</p>
      </div>
      <div class="row" style="margin-top:10px;justify-content:space-between">
        <button class="btn btn-outline" id="btnHome">Voltar à tela inicial</button>
        <button class="btn" id="btnRestart">Reiniciar</button>
      </div>
    </aside>
    <section class="board-wrap">
      <button class="btn-sound" id="btnSound" aria-label="Desligar som">
        <i class="bi bi-volume-up"></i>
      </button>
      <div id="board" class="board" role="grid" aria-label="Tabuleiro"></div>
    </section>
  </main>
  <section id="end" class="screen hidden">
    <div class="modal-content">
      <button class="home-button-modal" onclick="window.location.href='atividade.html'">
        <i class="bi bi-house-door"></i>
      </button>
      <div class="logo-container">
        <img src="Logo.png" alt="Logo" class="logo-img">
      </div>
      <div id="endWin" class="hidden">
        <h2 class="game-title"><i class="bi bi-trophy-fill"></i> Parabéns!</h2>
        <p class="game-subtitle">Você completou o jogo!</p>
      </div>
      <div id="endLose" class="hidden">
        <h2 class="game-title"><i class="bi bi-emoji-frown-fill"></i> Não foi desta vez!</h2>
        <p class="game-subtitle">Não desista, tente novamente.</p>
      </div>
      
      <div class="final-stats-container">
        <div class="stat-inline stat-box">
          <div class="stat-label">Bens Culturais</div>
          <div class="stat-value"><span id="finalGoods">0</span>/<span id="finalGoodsTotal">0</span></div>
        </div>
        <div class="stat-inline stat-box">
          <div class="stat-label">Saqueadores</div>
          <div class="stat-value"><span id="finalRaiders">0</span>/<span id="finalRaidersTotal">0</span></div>
        </div>
        <div class="stat-inline stat-box">
          <div class="stat-label">Tempo</div>
          <div class="stat-value"><span id="finalTime">0</span>s</div>
        </div>
        <div class="stat-inline stat-box">
          <div class="stat-label">Escavações</div>
          <div class="stat-value"><span id="finalExcavations">0</span>/<span id="finalExcavationsTotal">0</span></div>
        </div>
      </div>
      
      <button class="btn-game" id="btnPlayAgain">
        <i class="bi bi-arrow-clockwise"></i> Jogar Novamente
      </button>
    </div>
  </section>
  <div id="popup" class="hidden" role="dialog" aria-live="polite">
    <img id="popupImg" alt="Bem cultural" />
    <div class="txt"><p id="popupInfo"></p></div>
  </div>
  <div id="warningBox" class="hidden">
    <svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
      <path d="M32 8c-13 0-22 9-22 20 0 7 4 12 10 15v7c0 2 2 4 4 4h2v-6h4v6h4v-6h4v6h2c2 0 4-2 4-4v-7c6-3 10-8 10-15 0-11-9-20-22-20z" fill="#ffffff" stroke="#444" stroke-width="2"/>
      <circle cx="24" cy="28" r="5" fill="#111"/>
      <circle cx="40" cy="28" r="5" fill="#111"/>
      <rect x="28" y="36" width="8" height="4" rx="2" fill="#333"/>
    </svg>
    <span id="warningText"></span>
  </div>
  <script>
    // ===== DADOS DOS BENS =====
    const patrimonios = [
      {nome:'Prédio Prefeitura Municipal', img:'Prefeitura.png', info:'O Prédio Prefeitura Municipal, foi construído em 1933 por iniciativa de Isaltino de Paula, para abrigar o Cinema "Estrela Sul".'},
      {nome:'Imagem de Santo Antônio', img:'Imagem Santo Antonio.png', info:'A Imagem de Santo Antônio, possivelmente foi feita por volta de 1850, atualmente está exposta no Acervo do Museu Municipal João Elói.'},
      {nome:'Corporação Musical "Nova Aurora"', img:'Banda.png', info:'A Corporação Musical Olariense "Nova Aurora", fundada em 24 de outubro de 1936.'},
      {nome:'Cachoeira do Marciano', img:'Marciano.png', info:'A Cachoeira do Marciano, faz parte do Conjunto Paisagístico da Cachoeira do Marciano e está na área do Parque Estadual da Serra Negra da Mantiqueira.'},
      {nome:'Igreja de São Sebastião da Vista Alegre', img:'Sebastiao.png', info:'A Igreja de São Sebastião da Vista Alegre foi construída no ano de 1936, por iniciativa de moradores locais.'},
      {nome:'Acervo do Museu Municipal João Elói', img:'Museu.png', info:'O Acervo do Museu Municipal João Elói, começou em 1969, com as doações do acervo pessoal de Jesus de Oliveira, escritor e jornalista.'},
      {nome:'Gincana Cultural de Olaria', img:'Gincana.png', info:'A primeira Gincana Cultural de Olaria foi criada por um grupo de alunos da Escola Estadual Ataualpa Duque em 1997.'},
      {nome:'Cachoeira do Nariz', img:'Nariz.png', info:'A Cachoeira do Nariz, faz parte do Conjunto Paisagístico da Cachoeira do Marciano e está na área do Parque Estadual da Serra Negra da Mantiqueira.'},
      {nome:'Igreja Matriz de Santo Antônio', img:'Igreja Matriz.png', info:'A Igreja Matriz de Santo Antônio foi inaugurada em 16/07/1872. Sua construção foi autorizada em 1869 a pedido do Coronel João Caetano Rodrigues.'},
      {nome:'Reza para as Almas', img:'Reza.png', info:'A Reza para as Almas é uma manifestação popular, de caráter religioso, fundamenta na crença católica do purgatório.'},
      {nome:'Capela Senhor dos Passos', img:'Capela.png', info:'Ao redor da Capela Senhor dos Passos existem montes de pedra feitos pelos fiéis como pagamento de promessas.'},
      {nome:'Cachoeira do Pão de Angu', img:'Angu.png', info:'A Cachoeira do Pão de Angu, integra um Conjunto Paisagístico tombado, que possui trilhas centenárias que fazem parte da formação do município.'}
    ];
    // ===== NÍVEIS =====
    const levels = {
      beginner: { borders:2, cols:12, rows:10, goods:6,  raiders:3,  stones:3  },
      easy:     { borders:1, cols:12, rows:10, goods:8,  raiders:6,  stones:6  },
      medium:   { borders:0, cols:12, rows:10, goods:10, raiders:8,  stones:20 },
      hard:     { borders:0, cols:12, rows:10, goods:12, raiders:10, stones:10 }
    };
    // ===== SOM (sintético simples) =====
    class Sound { 
      constructor(){ 
        try { 
          this.ctx = new (window.AudioContext||window.webkitAudioContext)(); 
        } catch(e) { 
          this.ctx = null; 
        }
        this.enabled = true;
      }
      
      toggle() {
        this.enabled = !this.enabled;
        return this.enabled;
      }
      
      beep(f=600,d=.12,t='sine',v=.3,w=0){ 
        if(!this.ctx || !this.enabled) return; 
        const o=this.ctx.createOscillator(), g=this.ctx.createGain(); 
        o.type=t;
        o.frequency.value=f;
        o.connect(g);
        g.connect(this.ctx.destination);
        const ct=this.ctx.currentTime+w;
        g.gain.setValueAtTime(v,ct);
        g.gain.exponentialRampToValueAtTime(0.01,ct+d);
        o.start(ct);
        o.stop(ct+d); 
      }
      
      dig(){ 
        if (!this.enabled) return;
        this.beep(240,.12,'triangle',.25); 
        setTimeout(()=>this.beep(180,.12,'triangle',.22),90); 
      }
      
      success(){ 
        if (!this.enabled) return;
        this.beep(660,.1); 
        setTimeout(()=>this.beep(880,.12),120); 
        setTimeout(()=>this.beep(1046,.16),240); 
      }
      
      error(){ 
        if (!this.enabled) return;
        this.beep(220,.22,'sawtooth',.3); 
      }
      
      win(){ 
        if (!this.enabled) return;
        [523,659,784,1047].forEach((n,i)=>setTimeout(()=>this.beep(n,.22,'sine',.35),i*160)); 
      }
      
      lose(){ 
        if (!this.enabled) return;
        [392,349,330].forEach((n,i)=>setTimeout(()=>this.beep(n,.22,'sawtooth',.32),i*170)); 
      }
    }
    const SND = new Sound();
    // ===== ESTADO =====
    let state = { level:'beginner', cols:12, rows:10, grid:[], foundGoods:0, foundRaiders:0, mistakes:0, totalGoods:0, totalRaiders:0, totalSelectable:0, selectedCount:0, timer:0, tId:null, gameOver:false };
    // ===== UTIL =====
    const $ = id=>document.getElementById(id);
    const board = $('board');
    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=(Math.random()*(i+1))|0; [a[i],a[j]]=[a[j],a[i]];} return a; }
    // ===== ORIENTAÇÃO =====
    function checkOrientation(){ }
    window.addEventListener('resize', ()=>{ checkOrientation(); resizeBoard(); }); 
    
    // ===== CONTROLES INÍCIO/FIM =====
    document.querySelectorAll('#levels .btn-difficulty').forEach(b=>{ b.addEventListener('click',()=>{ document.querySelectorAll('#levels .btn-difficulty').forEach(x=>x.classList.remove('active')); b.classList.add('active'); state.level=b.dataset.level; }); });
    $('btnStart').onclick = ()=>startGame();
    $('btnHome').onclick = ()=>{ stopTimer(); $('start').classList.remove('hidden'); $('app').classList.add('hidden'); checkOrientation(); };
    $('btnRestart').onclick = ()=>startGame();
    $('btnPlayAgain').onclick = ()=>{ $('end').classList.add('hidden'); $('start').classList.remove('hidden'); checkOrientation(); };
    
    // Botão de som
    const soundBtn = $('btnSound');
    const soundIcon = soundBtn.querySelector('i');
    
    soundBtn.addEventListener('click', () => {
      const isEnabled = SND.toggle();
      soundBtn.classList.toggle('muted', !isEnabled);
      soundIcon.className = isEnabled ? 'bi bi-volume-up' : 'bi bi-volume-mute';
      soundBtn.setAttribute('aria-label', isEnabled ? 'Desligar som' : 'Ligar som');
    });
    // Tentativa de bloquear orientação em landscape e ativar tela cheia
    async function tryLockLandscape(){ try{
      if(document.fullscreenElement==null && document.documentElement.requestFullscreen) await document.documentElement.requestFullscreen();
      if(screen.orientation && screen.orientation.lock) await screen.orientation.lock('landscape');
    }catch(e){ /* falha silenciosa; mostramos instrução */ }
    }
    // Ativar tela cheia automaticamente
    function enterFullscreen() {
      try {
        if (document.documentElement.requestFullscreen) {
          document.documentElement.requestFullscreen();
        } else if (document.documentElement.webkitRequestFullscreen) {
          document.documentElement.webkitRequestFullscreen();
        } else if (document.documentElement.msRequestFullscreen) {
          document.documentElement.msRequestFullscreen();
        }
      } catch (e) {
        console.error('Erro ao ativar tela cheia:', e);
      }
    }
    // ===== GAME =====
    function startGame(){ 
      
      tryLockLandscape();
      enterFullscreen();
      
      const L = levels[state.level];
      state.cols=L.cols; state.rows=L.rows; state.gameOver=false; state.selectedCount=0; state.mistakes=0; state.foundGoods=0; state.foundRaiders=0; state.timer=0;
      const goodsPool=[...patrimonios]; shuffle(goodsPool); const chosenGoods=goodsPool.slice(0,L.goods);
      state.totalGoods=L.goods; state.totalRaiders=L.raiders;
      // cria grade vazia
      state.grid = Array.from({length: state.rows}, ()=> Array.from({length: state.cols}, ()=>({type:'empty', revealed:false})));
      // moldura
      if(L.borders>0){ for(let r=0;r<state.rows;r++) for(let c=0;c<state.cols;c++){ if(r<L.borders || r>=state.rows-L.borders || c<L.borders || c>=state.cols-L.borders){ state.grid[r][c]={type:'stone',revealed:false,block:true}; } } }
      // helpers colocação
      const freeCells = ()=>{ const arr=[]; for(let r=0;r<state.rows;r++) for(let c=0;c<state.cols;c++) if(state.grid[r][c].type==='empty') arr.push([r,c]); return arr; };
      place('stone', L.stones); place('raider', L.raiders); place('good', L.goods, (cell,i)=>{ cell.patrimony = chosenGoods[i]; });
      // totais
      state.totalSelectable=0; for(let r=0;r<state.rows;r++) for(let c=0;c<state.cols;c++) if(state.grid[r][c].type!=='stone') state.totalSelectable++;
      renderBoard(); updateStats(); stopTimer(); state.tId=setInterval(()=>{ state.timer++; $('timer').textContent=state.timer+'s'; },1000);
      $('start').classList.add('hidden'); $('end').classList.add('hidden'); $('app').classList.remove('hidden'); resizeBoard();
      function place(kind,count,onEach){ for(let i=0;i<count;i++){ const cells=freeCells(); if(!cells.length) break; const [r,c]=cells[(Math.random()*cells.length)|0]; const cell=state.grid[r][c]; cell.type=kind; if(onEach) onEach(cell,i); } }
    }
    function stopTimer(){ if(state.tId){ clearInterval(state.tId); state.tId=null; } }
    function renderBoard(){ board.style.setProperty('--cols', state.cols); board.style.setProperty('--rows', state.rows); board.innerHTML='';
      for(let r=0;r<state.rows;r++) for(let c=0;c<state.cols;c++){ const div=document.createElement('div'); const data=state.grid[r][c]; div.className='cell'; if(Math.random()<0.12) div.classList.add('vegetation'); if(data.type==='stone'){ div.classList.add('block'); div.innerHTML = stoneSVG(); } else { div.classList.add('selectable'); }
        div.addEventListener('click',(e)=>onCell(r,c,div,e)); board.appendChild(div); }
    }
    function onCell(r,c,div,e){ 
      if(state.gameOver) return; 
      const data=state.grid[r][c]; 
      if(data.revealed || data.type==='stone' || data.animating) return; 
      
      SND.dig(); 
      createDustEffect(div, e); 
      data.animating=true; 
      
      setTimeout(()=>{ 
        data.animating=false; 
        data.revealed=true; 
        div.classList.add('revealed'); 
        div.classList.remove('selectable'); 
        state.selectedCount++; 
        updateStats(); 
        
        if(data.type==='good'){ 
          state.foundGoods++; 
          SND.success(); 
          div.innerHTML=`<img class="thumb" src="${data.patrimony.img}" alt="${data.patrimony.nome}">`; 
          setTimeout(()=>{ 
            const t=div.querySelector('.thumb'); 
            if(t){ 
              t.addEventListener('click',ev=>{ 
                ev.stopPropagation(); 
                showPopup(data.patrimony); 
              }); 
            }
          },0); 
          const isLast = state.foundGoods >= state.totalGoods; 
          showPopup(data.patrimony, ()=>{ 
            if(isLast) endGame(true); 
          }); 
          updateStats(); 
        } else if(data.type==='raider'){ 
          state.foundRaiders++; 
          state.mistakes++; 
          SND.error(); 
          div.innerHTML = skullSVG(); 
          updateStats(); 
          if(state.mistakes>=3){ 
            endGame(false); 
            return; 
          } 
          const left = 3 - state.mistakes; 
          showWarning(`Cuidado, você foi saqueado, faltam ${left} saqueadores para o jogo terminar`); 
        } else { 
          const around = neighbors(r,c); 
          const nearGoods = around.filter(p=>p.type==='good').length; 
          const nearRaiders = around.filter(p=>p.type==='raider').length; 
          if(nearGoods===0 && nearRaiders===0){ 
            div.innerHTML=''; 
          } else { 
            div.innerHTML = renderHints(nearGoods, nearRaiders); 
          } 
        } 
      }, 900); 
    }
    // Função para criar efeito de poeira
    function createDustEffect(cell, event) {
      const rect = cell.getBoundingClientRect();
      
      // Posição do clique relativa à célula
      const x = event.clientX - rect.left;
      const y = event.clientY - rect.top;
      
      // Criar partículas de poeira
      for (let i = 0; i < 80; i++) {
        const dust = document.createElement('div');
        dust.classList.add('dust');
        
        // Posicionar dentro da célula
        dust.style.position = 'absolute';
        dust.style.left = `${x}px`;
        dust.style.top = `${y}px`;
        
        // Tons de marrom para a poeira
        const colors = [
          'rgba(139, 95, 64, 0.6)',
          'rgba(166, 124, 82, 0.7)',
          'rgba(181, 149, 113, 0.7)',
          'rgba(200, 170, 130, 0.6)',
          'rgba(141, 115, 85, 0.6)'
        ];
        dust.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        // Movimento em 360° limitado ao tamanho da célula
        const angle = Math.random() * Math.PI * 2;
        const speed = 10 + Math.random() * 25;
        const moveX = Math.cos(angle) * speed;
        const moveY = Math.sin(angle) * speed;
        
        dust.style.setProperty('--x', `${moveX}px`);
        dust.style.setProperty('--y', `${moveY}px`);
        
        // Escala final
        const scale = 2 + Math.random() * 2;
        dust.style.setProperty('--scale', scale);
        
        // Duração
        const duration = 0.6 + Math.random() * 0.6;
        const delay = Math.random() * 100;
        
        dust.style.animation = `fast-puff ${duration}s cubic-bezier(0.2, 0.6, 0.4, 1) ${delay}ms forwards`;
        
        // Adicionar à célula
        cell.appendChild(dust);
        
        // Remover após a animação
        setTimeout(() => {
          if (dust.parentNode) dust.remove();
        }, duration * 1000 + delay);
      }
    }
    function neighbors(r,c){ const arr=[]; for(let dr=-1;dr<=1;dr++) for(let dc=-1;dc<=1;dc++){ if(dr===0&&dc===0) continue; const rr=r+dr, cc=c+dc; if(rr>=0&&rr<state.rows&&cc>=0&&cc<state.cols) arr.push(state.grid[rr][cc]); } return arr; }
    function renderHints(nGoods,nRaid){ 
      const wrap=document.createElement('div'); 
      wrap.className='tile-flex'; 
      
      if(nGoods>0){ 
        const s=document.createElement('span'); 
        s.className='num'; 
        s.textContent=nGoods; 
        s.style.color = hintColorNumber(nGoods);
        wrap.appendChild(s); 
      } 
      
      const sp=document.createElement('div'); 
      sp.className='spacer'; 
      wrap.appendChild(sp); 
      
      if(nRaid>0){ 
        const ks=document.createElement('div'); 
        let size = nRaid>3 ? 12 : 14; 
        ks.className='skulls'; 
        ks.style.setProperty('--sk', size+'px'); 
        if(nRaid>4) ks.style.gridTemplateColumns='repeat(2, var(--sk))'; 
        for(let i=0;i<nRaid;i++){ 
          ks.insertAdjacentHTML('beforeend', skullTinySVG(hintColorSkull(nRaid))); 
        } 
        wrap.appendChild(ks); 
      } 
      return wrap.outerHTML; 
    }
    function hintColorNumber(n){ 
      const colors = [
        '#7ec8ff',
        '#9ACD32',
        '#FFD54F',
        '#FF9800',
        '#E53935',
        '#DC143C',
        '#722F37',
        '#8B4513'
      ];
      return colors[Math.min(n, 8) - 1];
    }
    function hintColorSkull(n){ 
      const colors = [
        '#FFD700',
        '#FF9800',
        '#F44336',
        '#DC143C',
        '#722F37',
        '#8B4513',
        '#5D4037',
        '#000000'
      ];
      return colors[Math.min(n, 8) - 1];
    }
    function updateStats(){ 
      $('goodsStat').textContent=`${state.foundGoods} de ${state.totalGoods}`; 
      $('raidersStat').textContent=`${state.foundRaiders} de ${state.totalRaiders}`; 
      $('excavations').textContent=`${state.selectedCount} de ${state.totalSelectable}`; 
      $('timer').textContent=state.timer+'s'; 
      
      $('finalGoods').textContent = state.foundGoods;
      $('finalGoodsTotal').textContent = state.totalGoods;
      $('finalRaiders').textContent = state.foundRaiders;
      $('finalRaidersTotal').textContent = state.totalRaiders;
      $('finalTime').textContent = state.timer;
      $('finalExcavations').textContent = state.selectedCount;
      $('finalExcavationsTotal').textContent = state.totalSelectable;
    }
    function endGame(win){ state.gameOver=true; stopTimer(); if(win) SND.win(); else SND.lose(); $('endWin').classList.toggle('hidden',!win); $('endLose').classList.toggle('hidden',win); $('finalTime').textContent=state.timer+'s'; $('finalGoods').textContent=state.foundGoods; $('finalGoodsTotal').textContent=state.totalGoods; $('finalRaiders').textContent=state.foundRaiders; $('finalRaidersTotal').textContent=state.totalRaiders; $('end').classList.remove('hidden'); checkOrientation(); }
    // ===== UI Aux =====
    function showPopup(p, onClose){ 
      const pop=$('popup'); 
      const panel=$('leftPanel').getBoundingClientRect(); 
      $('popupImg').src=p.img; 
      $('popupInfo').textContent=p.info; 
      pop.style.left=(panel.left + window.scrollX)+'px'; 
      pop.style.top=(panel.top + window.scrollY)+'px'; 
      pop.style.width=panel.width+'px'; 
      pop.classList.remove('hidden'); 
      clearTimeout(showPopup._t); 
      showPopup._t=setTimeout(()=>{ 
        pop.classList.add('hidden'); 
        if(onClose) onClose(); 
      }, 5000); 
    }
    function showWarning(text){ $('warningText').textContent=text; const w=$('warningBox'); w.classList.remove('hidden'); clearTimeout(showWarning._t); showWarning._t=setTimeout(()=>w.classList.add('hidden'), 4000); }
    // ===== SVG helpers =====
    function skullSVG(){ return `<svg class="skull" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path d="M32 8c-13 0-22 9-22 20 0 7 4 12 10 15v7c0 2 2 4 4 4h2v-6h4v6h4v-6h4v6h2c2 0 4-2 4-4v-7c6-3 10-8 10-15 0-11-9-20-22-20z" fill="#fafafa" stroke="#444" stroke-width="2"/><circle cx="24" cy="28" r="5" fill="#111"/><circle cx="40" cy="28" r="5" fill="#111"/><rect x="28" y="36" width="8" height="4" rx="2" fill="#333"/></svg>`; }
    function skullTinySVG(color){ return `<svg class='skull-small' viewBox='0 0 64 64' xmlns='http://www.w3.org/2000/svg'><path d='M32 10c-12 0-20 8-20 18 0 6 4 11 9 14v6c0 2 2 4 4 4h2v-5h4v5h4v-5h4v5h2c2 0 4-2 4-4v-6c5-3 9-8 9-14 0-10-8-18-20-18z' fill='${color}' stroke='#222' stroke-width='2'/><circle cx='24' cy='28' r='5' fill='#000'/><circle cx='40' cy='28' r='5' fill='#000'/></svg>`; }
    function stoneSVG(){ return `<svg viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg"><path d="M10 42 l8-20 18-8 18 10-6 18-16 8-18-8z" fill="#90A4AE" stroke="#455A64" stroke-width="2" opacity=".95"/><path d="M22 24 l6-6 8 2" stroke="#CFD8DC" stroke-width="2"/></svg>`; }
    // ===== CÁLCULO DO TAMANHO DA GRADE =====
    function resizeBoard(){ const panel = $('leftPanel'); const rect = panel.getBoundingClientRect(); const pad = 20; const availW = Math.max(120, window.innerWidth - rect.width - pad*2); const availH = Math.max(120, window.innerHeight - pad*2); const cell = Math.max(24, Math.floor(Math.min(availW/state.cols, availH/state.rows))); document.documentElement.style.setProperty('--cell', cell+'px'); }
    // Inicial
    $('app').classList.add('hidden');
    resizeBoard();
    
    // Tentar entrar em tela cheia ao carregar a página
    window.addEventListener('load', enterFullscreen);
    checkOrientation();
  </script>
</body>
</html>